{% extends "base.html" %}

{% block title %}Home - Ganglioside Analysis{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-5 mb-3">
            <i class="bi bi-graph-up-arrow text-primary"></i>
            LC-MS/MS Ganglioside Analysis Platform
        </h1>
        <p class="lead text-muted">
            Automated 5-rule algorithm for ganglioside structure prediction with ALCOA++ compliance
        </p>
    </div>
</div>

<!-- Quick Stats -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card card-hover text-center">
            <div class="card-body">
                <i class="bi bi-file-earmark-arrow-up fs-1 text-primary"></i>
                <h3 class="mt-3">Upload Data</h3>
                <p class="text-muted">Start new analysis</p>
                <a href="{% url 'analysis:upload' %}" class="btn btn-primary">Upload CSV</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-hover text-center">
            <div class="card-body">
                <i class="bi bi-clock-history fs-1 text-success"></i>
                <h3 class="mt-3">History</h3>
                <p class="text-muted">View past analyses</p>
                <a href="{% url 'analysis:history' %}" class="btn btn-success">View History</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-hover text-center">
            <div class="card-body">
                <i class="bi bi-bar-chart-line fs-1 text-info"></i>
                <h3 class="mt-3">Dashboard</h3>
                <p class="text-muted">Visualizations</p>
                <a href="{% url 'visualization:dashboard' %}" class="btn btn-info">Open Dashboard</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-hover text-center">
            <div class="card-body">
                <i class="bi bi-book fs-1 text-warning"></i>
                <h3 class="mt-3">API Docs</h3>
                <p class="text-muted">Developer guide</p>
                <a href="/api/docs/" class="btn btn-warning">View Docs</a>
            </div>
        </div>
    </div>
</div>

<!-- Recent Sessions -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history"></i> Recent Analyses
                </h5>
            </div>
            <div class="card-body">
                {% if recent_sessions %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Session</th>
                                <th>File</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Duration</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for session in recent_sessions %}
                            <tr>
                                <td>
                                    <strong>{{ session.name|default:"Session #"|add:session.id|stringformat:"s" }}</strong>
                                </td>
                                <td>
                                    <small class="text-muted">{{ session.original_filename }}</small>
                                </td>
                                <td>
                                    {% if session.status == 'completed' %}
                                        <span class="badge bg-success">Completed</span>
                                    {% elif session.status == 'processing' %}
                                        <span class="badge bg-warning">Processing</span>
                                    {% elif session.status == 'failed' %}
                                        <span class="badge bg-danger">Failed</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Pending</span>
                                    {% endif %}
                                </td>
                                <td>{{ session.created_at|date:"Y-m-d H:i" }}</td>
                                <td>
                                    {% if session.duration %}
                                        {{ session.duration|floatformat:2 }}s
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'analysis:session_detail' session.id %}" class="btn btn-sm btn-primary">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-inbox fs-1 text-muted"></i>
                    <p class="text-muted mt-3">No analyses yet. <a href="{% url 'analysis:upload' %}">Upload your first dataset!</a></p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Algorithm Overview -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> 5-Rule Algorithm Overview</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Rule 1: Prefix-Based Regression</h6>
                        <p class="small text-muted">Multiple regression by compound prefix (GD1, GM3, etc.) with outlier detection</p>

                        <h6>Rule 2-3: Sugar Count & Isomers</h6>
                        <p class="small text-muted">Calculate total sugars and identify structural isomers (GD1a/b, GQ1b/c)</p>

                        <h6>Rule 4: O-Acetylation Validation</h6>
                        <p class="small text-muted">Validate RT increase for O-acetylated compounds</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Rule 5: Fragmentation Detection</h6>
                        <p class="small text-muted">Merge fragmentation products within RT tolerance (±0.1 min)</p>

                        <h6>Performance Metrics</h6>
                        <ul class="small">
                            <li>R² ≥ 0.92 (Leave-One-Out validation)</li>
                            <li>ALCOA++ compliant audit trail</li>
                            <li>Separate models for modified gangliosides</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
