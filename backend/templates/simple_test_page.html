<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ganglioside Analyzer - ê°„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .control-group {
            margin: 15px 0;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        
        .slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .value-display {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            font-weight: bold;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success { background: #27ae60; }
        .btn-warning { background: #f39c12; }
        .btn-danger { background: #e74c3c; }
        
        .result {
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        
        .error {
            background: #e74c3c;
        }
        
        .warning {
            background: #f39c12;
        }
        
        .info {
            background: #3498db;
        }
        
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #3498db;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .status-bar {
            background: #34495e;
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§¬ Ganglioside Analyzer</h1>
        <p>ì¸í„°ë™í‹°ë¸Œ ë¶„ì„ ì‹œìŠ¤í…œ - í…ŒìŠ¤íŠ¸ ë²„ì „</p>
    </div>
    
    <div class="status-bar" id="statusBar">
        ğŸ”„ ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...
    </div>
    
    <!-- ì„¤ì • íŒ¨ë„ -->
    <div class="section">
        <h2>âš™ï¸ ë¶„ì„ ì„¤ì •</h2>
        
        <div class="control-group">
            <label><strong>ğŸ“Š í‘œì¤€í™” ì”ì°¨ ì„ê³„ê°’:</strong></label>
            <input type="range" id="outlierThreshold" class="slider" min="1.0" max="5.0" step="0.1" value="3.0">
            <div class="value-display" id="outlierValue">3.0</div>
            <p><small>ì´ìƒì¹˜ íŒë³„ ê¸°ì¤€ (ë†’ì„ìˆ˜ë¡ ì—„ê²©)</small></p>
        </div>
        
        <div class="control-group">
            <label><strong>ğŸ“ˆ RÂ² ì„ê³„ê°’:</strong></label>
            <input type="range" id="r2Threshold" class="slider" min="0.90" max="0.999" step="0.001" value="0.99">
            <div class="value-display" id="r2Value">0.990</div>
            <p><small>íšŒê·€ë¶„ì„ í’ˆì§ˆ ê¸°ì¤€ (ë†’ì„ìˆ˜ë¡ ì—„ê²©)</small></p>
        </div>
        
        <div class="control-group">
            <label><strong>â±ï¸ RT í—ˆìš© ë²”ìœ„ (ë¶„):</strong></label>
            <input type="range" id="rtTolerance" class="slider" min="0.05" max="0.5" step="0.01" value="0.1">
            <div class="value-display" id="rtValue">Â±0.10</div>
            <p><small>ë™ì¼ ì ‘ë¯¸ì‚¬ ê·¸ë£¹ ë‚´ RT í—ˆìš© ì˜¤ì°¨</small></p>
        </div>
        
        <div class="control-group">
            <label><strong>ğŸ”¬ ë¶„ì„ ëª¨ë“œ:</strong></label><br>
            <input type="radio" name="analysisMode" value="Porcine" checked> ğŸ· Porcine &nbsp;&nbsp;
            <input type="radio" name="analysisMode" value="Mouse"> ğŸ­ Mouse
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn" onclick="resetSettings()">ğŸ”„ ê¸°ë³¸ê°’ ë³µì›</button>
            <button class="btn btn-warning" onclick="exportSettings()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
        </div>
    </div>
    
    <!-- íŒŒì¼ ì—…ë¡œë“œ ë° ë¶„ì„ -->
    <div class="grid">
        <div class="section">
            <h3>ğŸ“„ íŒŒì¼ ì—…ë¡œë“œ</h3>
            <input type="file" id="csvFile" accept=".csv">
            <button class="btn" onclick="uploadFile()">ğŸ“¤ ì—…ë¡œë“œ</button>
            <button class="btn btn-success" onclick="analyzeData()">ğŸ”¬ ë¶„ì„</button>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š ê²°ê³¼ ë° ì‹œê°í™”</h3>
            <button class="btn btn-warning" onclick="createVisualization()">ğŸ“ˆ ì‹œê°í™”</button>
            <button class="btn btn-success" onclick="downloadResults()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
        </div>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
    <div class="section">
        <h3>ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„°</h3>
        <button class="btn btn-success" onclick="testSampleData()">ğŸš€ ê¸°ë³¸ ìƒ˜í”Œ</button>
        <button class="btn btn-warning" onclick="testComplexSample()">ğŸ§¬ ë³µí•© ìƒ˜í”Œ</button>
        <button class="btn btn-danger" onclick="testChallengeData()">ğŸ’€ ë„ì „ ë°ì´í„°</button>
    </div>
    
    <!-- ê²°ê³¼ í‘œì‹œ -->
    <div id="result"></div>
    
    <!-- ì‹œê°í™” ì˜ì—­ -->
    <div id="visualizationContainer" style="display: none;">
        <div class="section">
            <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
            <div id="visualizations"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentAnalysisResults = null;
        let currentSettings = {
            outlierThreshold: 3.0,
            r2Threshold: 0.99,
            rtTolerance: 0.1,
            analysisMode: 'Porcine'
        };
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeControls();
            checkAPIStatus();
        });
        
        // ì»¨íŠ¸ë¡¤ ì´ˆê¸°í™”
        function initializeControls() {
            // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('outlierThreshold').addEventListener('input', function() {
                const value = parseFloat(this.value);
                document.getElementById('outlierValue').textContent = value.toFixed(1);
                currentSettings.outlierThreshold = value;
                onSettingChange('outlierThreshold', value);
            });
            
            document.getElementById('r2Threshold').addEventListener('input', function() {
                const value = parseFloat(this.value);
                document.getElementById('r2Value').textContent = value.toFixed(3);
                currentSettings.r2Threshold = value;
                onSettingChange('r2Threshold', value);
            });
            
            document.getElementById('rtTolerance').addEventListener('input', function() {
                const value = parseFloat(this.value);
                document.getElementById('rtValue').textContent = `Â±${value.toFixed(2)}`;
                currentSettings.rtTolerance = value;
                onSettingChange('rtTolerance', value);
            });
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('input[name="analysisMode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentSettings.analysisMode = this.value;
                    onSettingChange('analysisMode', this.value);
                });
            });
        }
        
        // ì„¤ì • ë³€ê²½ ê°ì§€
        function onSettingChange(setting, value) {
            console.log(`ì„¤ì • ë³€ê²½: ${setting} = ${value}`);
            showResult(`âš™ï¸ ì„¤ì • ë³€ê²½: ${setting} = ${value}`, 'info');
            
            // ìë™ ì¬ë¶„ì„ (ë°ì´í„°ê°€ ìˆì„ ë•Œ)
            if (currentAnalysisResults) {
                setTimeout(() => {
                    showResult('ğŸ”„ ì„¤ì •ì´ ë³€ê²½ë˜ì–´ ì¬ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤...', 'info');
                    // ì—¬ê¸°ì„œ ì‹¤ì œ ì¬ë¶„ì„ í˜¸ì¶œ
                }, 1000);
            }
        }
        
        // ê¸°ë³¸ê°’ ë³µì›
        function resetSettings() {
            document.getElementById('outlierThreshold').value = 3.0;
            document.getElementById('r2Threshold').value = 0.99;
            document.getElementById('rtTolerance').value = 0.1;
            document.querySelector('input[value="Porcine"]').checked = true;
            
            document.getElementById('outlierValue').textContent = '3.0';
            document.getElementById('r2Value').textContent = '0.990';
            document.getElementById('rtValue').textContent = 'Â±0.10';
            
            currentSettings = {
                outlierThreshold: 3.0,
                r2Threshold: 0.99,
                rtTolerance: 0.1,
                analysisMode: 'Porcine'
            };
            
            showResult('ğŸ”„ ëª¨ë“  ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        // ì„¤ì • ì €ì¥
        function exportSettings() {
            const settingsData = {
                settings: currentSettings,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(settingsData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `settings_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showResult('ğŸ’¾ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'info');
        }
        
        // API ìƒíƒœ í™•ì¸
        async function checkAPIStatus() {
            try {
                updateStatus('ğŸ”„ API ì—°ê²° í™•ì¸ ì¤‘...');
                const response = await fetch(`${API_BASE}/`);
                const result = await response.json();
                updateStatus('âœ… API ì—°ê²° ì„±ê³µ - í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
                showResult(`âœ… ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ!\n\nAPI ìƒíƒœ: ì •ìƒ\nì„œë²„: ${API_BASE}\n\nì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!`, 'info');
            } catch (error) {
                updateStatus('âŒ API ì—°ê²° ì‹¤íŒ¨');
                showResult(`âŒ API ì—°ê²° ì‹¤íŒ¨\n\nì˜¤ë¥˜: ${error.message}\nì„œë²„: ${API_BASE}\n\nì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`, 'error');
            }
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ
        async function uploadFile() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('âš ï¸ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            showResult(`ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ: ${file.name} (${(file.size/1024).toFixed(1)} KB)`, 'info');
        }
        
        // ë°ì´í„° ë¶„ì„
        async function analyzeData() {
            try {
                updateStatus('ğŸ”¬ ë°ì´í„° ë¶„ì„ ì¤‘...');
                
                // í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ë¶„ì„ ìš”ì²­
                const formData = new FormData();
                if (document.getElementById('csvFile').files[0]) {
                    formData.append('file', document.getElementById('csvFile').files[0]);
                } else {
                    // ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                    const sampleCSV = `Name,RT,Volume,Log P,Anchor
GD1a(36:1;O2),9.572,1000000,1.53,T
GM1a(36:1;O2),10.452,500000,4.00,F
GM3(36:1;O2),10.606,2000000,7.74,F
GD3(36:1;O2),10.126,800000,5.27,T
GT1b(36:1;O2),8.701,1200000,-0.94,T`;
                    
                    const blob = new Blob([sampleCSV], { type: 'text/csv' });
                    formData.append('file', blob, 'sample.csv');
                }
                
                formData.append('data_type', currentSettings.analysisMode);
                
                const response = await fetch(`${API_BASE}/api/analyze`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    currentAnalysisResults = result.results;
                    displayAnalysisResults(result.results);
                    updateStatus('âœ… ë¶„ì„ ì™„ë£Œ');
                } else {
                    showResult(`âŒ ë¶„ì„ ì‹¤íŒ¨: ${result.detail}`, 'error');
                    updateStatus('âŒ ë¶„ì„ ì‹¤íŒ¨');
                }
            } catch (error) {
                showResult(`âŒ ë¶„ì„ ì˜¤ë¥˜: ${error.message}`, 'error');
                updateStatus('âŒ ë¶„ì„ ì˜¤ë¥˜');
            }
        }
        
        // ì‹œê°í™” ìƒì„±
        function createVisualization() {
            if (!currentAnalysisResults) {
                showResult('âš ï¸ ë¨¼ì € ë°ì´í„° ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            document.getElementById('visualizationContainer').style.display = 'block';
            
            const stats = currentAnalysisResults.statistics;
            const html = `
                <div style="background: #3498db; color: white; padding: 20px; border-radius: 8px; margin: 10px 0;">
                    <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼ ëŒ€ì‹œë³´ë“œ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                        <div style="text-align: center;">
                            <h2>${stats.total_compounds || 0}</h2>
                            <p>ì´ í™”í•©ë¬¼</p>
                        </div>
                        <div style="text-align: center;">
                            <h2>${stats.valid_compounds || 0}</h2>
                            <p>ìœ íš¨ í™”í•©ë¬¼</p>
                        </div>
                        <div style="text-align: center;">
                            <h2>${stats.outliers || 0}</h2>
                            <p>ì´ìƒì¹˜</p>
                        </div>
                        <div style="text-align: center;">
                            <h2>${(stats.success_rate || 0).toFixed(1)}%</h2>
                            <p>ì„±ê³µë¥ </p>
                        </div>
                    </div>
                </div>
                
                <div style="background: #ecf0f1; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h4>ğŸ›ï¸ í˜„ì¬ ì„¤ì •</h4>
                    <p><strong>í‘œì¤€í™” ì”ì°¨ ì„ê³„ê°’:</strong> ${currentSettings.outlierThreshold}</p>
                    <p><strong>RÂ² ì„ê³„ê°’:</strong> ${currentSettings.r2Threshold}</p>
                    <p><strong>RT í—ˆìš© ë²”ìœ„:</strong> Â±${currentSettings.rtTolerance}ë¶„</p>
                    <p><strong>ë¶„ì„ ëª¨ë“œ:</strong> ${currentSettings.analysisMode}</p>
                </div>
            `;
            
            document.getElementById('visualizations').innerHTML = html;
            showResult('ğŸ“Š ì‹œê°í™”ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'info');
        }
        
        // ìƒ˜í”Œ ë°ì´í„° í…ŒìŠ¤íŠ¸
        function testSampleData() {
            showResult('ğŸš€ ê¸°ë³¸ ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            setTimeout(() => {
                analyzeData();
            }, 1000);
        }
        
        // ë³µí•© ìƒ˜í”Œ í…ŒìŠ¤íŠ¸
        function testComplexSample() {
            showResult('ğŸ§¬ ë³µí•© ìƒ˜í”Œ ë°ì´í„° ì¤€ë¹„ ì¤‘...\n\n- ë‹¤ì–‘í•œ ì´ì„±ì§ˆì²´\n- O-acetylation í™”í•©ë¬¼\n- ë³µì¡í•œ êµ¬ì¡°', 'info');
        }
        
        // ë„ì „ ë°ì´í„° í…ŒìŠ¤íŠ¸
        function testChallengeData() {
            if (confirm('âš ï¸ ë„ì „ ë°ì´í„°ëŠ” ë¶„ì„í•˜ê¸° ì–´ë ¤ìš´ ë°ì´í„°ì…ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                showResult('ğŸ’€ ë„ì „ ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹œì‘!\n\nì´ ë°ì´í„°ëŠ” ë‚®ì€ ì„±ê³µë¥ ì´ ì˜ˆìƒë©ë‹ˆë‹¤.', 'warning');
            }
        }
        
        // ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
        function downloadResults() {
            if (!currentAnalysisResults) {
                showResult('âš ï¸ ë‹¤ìš´ë¡œë“œí•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            showResult('ğŸ’¾ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (ê°œë°œ ì¤‘)', 'info');
        }
        
        // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        function displayAnalysisResults(results) {
            const stats = results.statistics;
            const summary = `ğŸ”¬ ë¶„ì„ ì™„ë£Œ!

=== ë¶„ì„ ìš”ì•½ ===
ì´ í™”í•©ë¬¼ ìˆ˜: ${stats.total_compounds}
ìœ íš¨ í™”í•©ë¬¼: ${stats.valid_compounds}
ì´ìƒì¹˜: ${stats.outliers}
ì„±ê³µë¥ : ${stats.success_rate.toFixed(1)}%

=== í˜„ì¬ ì„¤ì • ===
í‘œì¤€í™” ì”ì°¨ ì„ê³„ê°’: ${currentSettings.outlierThreshold}
RÂ² ì„ê³„ê°’: ${currentSettings.r2Threshold}
RT í—ˆìš© ë²”ìœ„: Â±${currentSettings.rtTolerance}ë¶„
ë¶„ì„ ëª¨ë“œ: ${currentSettings.analysisMode}

ë¶„ì„ ìƒíƒœ: ${results.status}`;

            showResult(summary, 'info');
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }
        
        function updateStatus(message) {
            document.getElementById('statusBar').textContent = message;
        }
        
        console.log('ğŸ§¬ Ganglioside Analyzer - ê°„ë‹¨ í…ŒìŠ¤íŠ¸ ë²„ì „ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>